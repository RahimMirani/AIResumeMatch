<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Parser</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="upload-container">
        <h2>Upload Resume</h2>
        <form id="uploadForm">
            <input type="file" name="resume" accept=".pdf" required>
            <button type="submit">Parse Resume</button>
        </form>
    </div>

    <div id="result" class="resume-container" style="display: none;">
        <div class="header">
            <h1 class="name"></h1>
            <div class="contact-info"></div>
        </div>
        <div class="sections"></div>
    </div>

    <script>
        function displayResume(data) {
            console.log('Displaying resume data:', data);  // Debug log
            const result = document.getElementById('result');
            
            try {
                // Display name and contact info
                result.querySelector('.name').textContent = data.personal_info.name;
                
                const contactInfo = result.querySelector('.contact-info');
                const contact = data.personal_info.contact;
                contactInfo.innerHTML = `
                    ${contact.email} | ${contact.phone} | ${contact.location}
                `;

                // Display sections
                const sectionsContainer = result.querySelector('.sections');
                sectionsContainer.innerHTML = data.sections.map(section => {
                    console.log('Processing section:', section);  // Debug log
                    const entries = section.entries || [];
                    return `
                        <div class="section">
                            <h2>${section.title}</h2>
                            ${entries.map(entry => {
                                console.log('Processing entry:', entry);  // Debug log
                                return `
                                    <div class="entry">
                                        ${entry.company ? `
                                            <div class="entry-header">
                                                <span class="company">${entry.company}</span>
                                                ${entry.location ? `<span class="location">${entry.location}</span>` : ''}
                                                ${entry.duration ? `<span class="duration">${entry.duration}</span>` : ''}
                                            </div>
                                        ` : ''}
                                        ${entry.position ? `<div class="position">${entry.position}</div>` : ''}
                                        ${entry.points && entry.points.length > 0 ? `
                                            <ul class="points">
                                                ${entry.points.map(point => `
                                                    <li>${point}</li>
                                                `).join('')}
                                            </ul>
                                        ` : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }).join('');

                result.style.display = 'block';
            } catch (error) {
                console.error('Error displaying resume:', error);  // Debug log
                alert('Error displaying resume');
            }
        }

        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData();
            const fileInput = document.querySelector('input[type="file"]');
            formData.append('resume', fileInput.files[0]);

            try {
                console.log('Uploading file...');
                const response = await fetch('/upload-resume', {
                    method: 'POST',
                    body: formData
                });
                console.log('Response status:', response.status);
                
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    throw new TypeError("Response was not JSON");
                }
                
                const data = await response.json();
                console.log('Response data:', data);
                
                if (!data) {
                    throw new Error('No data received');
                }
                
                if (!data.parsed_data) {
                    throw new Error('No parsed_data in response');
                }
                
                if (response.ok && data.parsed_data) {
                    displayResume(data.parsed_data);
                } else {
                    console.error('Error:', data.error);
                    alert(data.error || 'Upload failed');
                }
            } catch (error) {
                console.error('Error details:', error);
                alert('Error uploading file: ' + error.message);
            }
        });
    </script>
</body>
</html> 